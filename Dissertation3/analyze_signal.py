import numpy as np
from numpy.fft import fft, fftshift, fftfreq, ifftshift
from collections import namedtuple
from numpy.linalg import norm

FFT = namedtuple('FFT','psd,psd_db,freq,normed_signal,raw_fft'.split(','))

def psd(signal, sampling_rate,hide_bias=False):
    n = len(signal)
    shifted_signal = signal - signal.mean()
   # windowed_signal = np.hamming(n) * shifted_signal
   # normed_signal = windowed_signal/norm(windowed_signal)
    normed_signal = shifted_signal/norm(shifted_signal)
    g = fftshift(fft(normed_signal,norm='ortho'))
    psd = np.abs(g)
    psd_db = 10*np.log10(psd)
    freq = fftshift(fftfreq(n, sampling_rate))
    if hide_bias:
        psd_db[int(n/2)-1:int(n/2)+2]=0
    return FFT(psd, psd_db,freq, normed_signal, g)

if __name__ == "__main__":
    s = np.array([0.96924, 0.9182 , 0.83614, 0.83397, 0.83272, 0.78613, 0.77044,
       0.77674, 0.77878, 0.77483, 0.77735, 0.81913, 0.84487, 0.83274,
       0.86988, 0.92744, 0.92313, 0.92027, 0.97579, 1.01422, 1.00593,
       1.0056 , 1.02427, 1.03419, 1.03359, 1.03404, 1.02319, 1.00998,
       1.01106, 1.01268, 1.00558, 0.99907, 0.99909, 0.99955, 0.99958,
       0.99893, 0.99944, 1.00073, 0.98861, 0.97075, 0.97413, 0.9765 ,
       0.93891, 0.90654, 0.9076 , 0.91269, 0.92419, 0.93148, 0.928  ,
       0.93225, 0.93858, 0.93994, 0.94034, 0.93068, 0.9189 , 0.91887,
       0.91989, 0.92042, 0.92212, 0.9201 , 0.92439, 0.93745, 0.94089,
       0.93725, 0.94639, 0.95936, 0.96005, 0.95856, 0.96127, 0.95996,
       0.96301, 0.96196, 0.93441, 0.91448, 0.91086, 0.92401, 0.96959,
       0.99081, 0.97699, 0.99238, 1.03321, 1.04521, 1.03982, 1.0413 ,
       1.03897, 1.03643, 1.03789, 1.03719, 1.03067, 1.02248, 1.02722,
       1.02736, 0.98777, 0.95648, 0.95742, 0.96164, 0.98266, 0.99866,
       0.99469, 0.99498, 0.99858, 0.99963, 0.99909, 0.99947, 1.0013 ,
       1.00018, 1.00318, 1.00029, 0.9742 , 0.95746, 0.9635 , 0.95942,
       0.9469 , 0.94359, 0.93917, 0.9566 , 0.99619, 1.00551, 0.99827,
       1.00487, 1.01432, 1.01637, 1.01396, 1.01797, 1.02757, 1.0309 ,
       1.02763, 1.03133, 1.04289, 1.04508, 1.04697, 1.04407, 1.01474,
       0.99408, 1.00208, 0.99887, 0.96642, 0.94573, 0.95632, 0.94477,
       0.89995, 0.88509, 0.89244, 0.87896, 0.86682, 0.86049, 0.87303,
       0.92263, 0.94467, 0.93011, 0.95389, 0.99766, 1.00438, 1.0007 ,
       0.99778, 0.98689, 0.9845 , 0.98441, 0.99104, 1.00444, 1.00655,
       1.00436, 1.00593, 1.00305, 1.00153, 1.00972, 0.98338, 0.93225,
       0.92296, 0.9299 , 0.92751, 0.92959, 0.92907, 0.92991, 0.93371,
       0.93349, 0.94108, 0.9236 , 0.87171, 0.8535 , 0.86105, 0.86688,
       0.87457, 0.87113, 0.88003, 0.90044, 0.90795, 0.90817, 0.87757,
       0.84146, 0.84249, 0.84339, 0.83642, 0.83366, 0.83664, 0.85333,
       0.86547, 0.86509, 0.85358, 0.83844, 0.83035, 0.84185, 0.88019,
       0.89618, 0.88727, 0.90538, 0.93163, 0.92886, 0.92777, 0.95587,
       0.97188, 0.9747 , 0.96857, 0.92477, 0.89641, 0.89985, 0.90956,
       0.93021, 0.9357 , 0.93108, 0.94112, 0.94836, 0.95121, 0.95001,
       0.92099, 0.89687, 0.89745, 0.90416, 0.91885, 0.92535, 0.9231 ,
       0.92167, 0.91709, 0.91739, 0.91851, 0.90432, 0.89204, 0.90036,
       0.88472, 0.84104, 0.82905, 0.8359 , 0.83129, 0.83085, 0.83379,
       0.81979, 0.80297, 0.80292, 0.8027 , 0.79837, 0.79495, 0.80231,
       0.8214 , 0.83058, 0.82721, 0.81066, 0.80014, 0.80317, 0.78629,
       0.76647, 0.76479, 0.77372, 0.77858, 0.76946, 0.8117 , 0.88206,
       0.88718, 0.88021, 0.90371, 0.91452, 0.9082 , 0.91774, 0.93625,
       0.9405 , 0.94221, 0.92291, 0.8887 , 0.8941 , 0.88895, 0.83089,
       0.7928 , 0.79996, 0.84282, 0.88146, 0.87706, 0.8783 , 0.90356,
       0.90451, 0.89494, 0.95697, 1.02937, 1.02852, 1.01995, 1.03617,
       1.04891, 1.04957, 1.05035, 1.04524, 1.03119, 1.02773, 1.03064,
       1.02786, 1.02109, 1.01741, 1.02217, 1.0153 , 0.9891 , 0.9781 ,
       0.983  , 0.98021, 0.97427, 0.973  , 0.97353, 0.97346, 0.97528,
       0.97605, 0.97327, 0.98203, 0.99798, 1.00055, 0.99913, 0.99756,
       0.99181, 0.99065, 0.99242, 0.98855, 0.9815 , 0.98072, 0.9831 ,
       0.97512, 0.96639, 0.96453, 0.96347, 0.98231, 1.00424, 1.00436,
       1.00314, 0.9979 , 0.98892, 0.98891, 0.98983, 0.98878, 0.98632,
       0.988  , 0.98913, 0.96867, 0.95118, 0.94896, 0.95263, 0.98138,
       1.00375, 0.99821, 0.99874, 1.01169, 1.01836, 1.01732, 1.01715,
       1.01472, 1.00968, 1.01233, 1.01277, 0.98827, 0.96632, 0.96967,
       0.97037, 0.95753, 0.94837, 0.95532, 0.94593, 0.91161, 0.89608,
       0.89582, 0.92128, 0.96756, 0.9704 , 0.95929, 1.00721, 1.05979,
       1.05972, 1.05403, 1.06103, 1.06488, 1.06457, 1.06731, 1.06202,
       1.04017, 1.03005, 1.03527, 1.03248, 1.018  , 1.00852, 1.01337,
       1.01071, 0.98688, 0.97275, 0.97565, 0.97596, 0.97773, 0.98039,
       0.97826, 0.98081, 0.99054, 0.99416, 0.99361, 0.99229, 0.9855 ,
       0.98205, 0.98471, 0.9813 , 0.97146, 0.96827, 0.97008, 0.96853,
       0.96557, 0.96507, 0.96604, 0.96311, 0.95721, 0.95705, 0.9589 ,
       0.94874, 0.93623, 0.93762, 0.93794, 0.92584, 0.91832, 0.91899,
       0.92084, 0.92382, 0.92581, 0.92696, 0.91732, 0.90495, 0.90124,
       0.90376, 0.92753, 0.94888, 0.93834, 0.94963, 1.00043, 1.02013,
       1.01487, 1.0137 , 0.99465, 0.97968, 0.99149, 0.97809, 0.9215 ,
       0.89709, 0.90506, 0.90487, 0.90982, 0.90875, 0.90831, 0.93762,
       0.96193, 0.95539, 0.95821, 0.98251, 0.99377, 0.99092, 0.99093,
       0.98767, 0.98359, 0.98751, 0.98275, 0.95891, 0.94749, 0.95573,
       0.94269, 0.91436, 0.90646, 0.9092 , 0.92137, 0.93517, 0.93685,
       0.93547, 0.91515, 0.89767, 0.91305, 0.88024, 0.79869, 0.77651,
       0.79079, 0.79649, 0.79935, 0.79939, 0.81094, 0.81632, 0.81317,
       0.83433, 0.85677, 0.85768, 0.85064, 0.83924, 0.83293, 0.837  ,
       0.84502, 0.85205, 0.8556 , 0.83195, 0.79666, 0.79187, 0.80137,
       0.80752, 0.81536, 0.80822, 0.77643, 0.76657, 0.76634, 0.73347,
       0.71543, 0.71967, 0.71473, 0.70756, 0.71578, 0.73031, 0.72121,
       0.75554, 0.83692, 0.84733, 0.84155, 0.89315, 0.92042, 0.90905,
       0.92035, 0.9452 , 0.94929, 0.94585, 0.94985, 0.9537 , 0.95331,
       0.95305, 0.95603, 0.95639, 0.95879, 0.95743, 0.93377, 0.91618,
       0.92051, 0.91837, 0.90873, 0.90653, 0.9084 , 0.90462, 0.89794,
       0.90133, 0.89781, 0.87376, 0.85883, 0.85868, 0.87733, 0.90497,
       0.9071 , 0.90367, 0.91474, 0.9218 , 0.91602, 0.92577, 0.95708,
       0.96742, 0.95921, 0.97189, 0.99518, 0.99929, 0.99597, 0.99848,
       0.99919, 0.99876, 1.00151, 0.99292, 0.97743, 0.97438, 0.97361,
       0.98534, 1.00627, 1.00888, 1.00682, 1.00598, 1.00395, 1.00397,
       0.99955, 1.01704, 1.04902, 1.0535 , 1.05076, 1.04972, 1.03955,
       1.03633, 1.03743, 1.03788, 1.04295, 1.04669, 1.04445, 1.045  ,
       1.05723, 1.06374, 1.06332, 1.06583, 1.04501, 1.01791, 1.018  ,
       1.02207, 1.01188, 1.00164, 1.00085, 1.00094, 1.00511, 1.01102,
       1.01144, 1.01305, 1.00275, 0.98344, 0.98188, 0.9868 , 0.97053,
       0.9522 , 0.94965, 0.95097, 0.96725, 0.98143, 0.98327, 0.98179,
       0.95199, 0.92623, 0.92872, 0.93113, 0.93796, 0.94367, 0.93772,
       0.95027, 0.97548, 0.98078, 0.98251, 0.96486, 0.9314 , 0.92389,
       0.92719, 0.94569, 0.96991, 0.96734, 0.96551, 0.98518, 0.99498,
       0.99758, 0.99588, 0.95549, 0.92357, 0.92554, 0.93159, 0.95013,
       0.96079, 0.95456, 0.96207, 0.97497, 0.97704, 0.98278, 0.95841,
       0.91144, 0.90025, 0.90638, 0.92588, 0.9476 , 0.94562, 0.94483,
       0.94769, 0.94524, 0.95218, 0.93849, 0.89321, 0.87623, 0.88278,
       0.88579, 0.89139, 0.8917 , 0.89136, 0.8963 , 0.898  , 0.8963 ,
       0.90159, 0.90868, 0.91083, 0.90848, 0.9011 , 0.89675, 0.88919,
       0.91029, 0.96536, 0.98163, 0.97096, 0.98068, 0.99011, 0.99035,
       0.99746, 0.97027, 0.91881, 0.90839, 0.91502, 0.92607, 0.94066,
       0.93968, 0.93908, 0.9399 , 0.93746, 0.9441 , 0.92938, 0.88955,
       0.87442, 0.87903, 0.90053, 0.92545, 0.92355, 0.92301, 0.93401,
       0.93762, 0.93926, 0.93234, 0.91564, 0.90941, 0.91022, 0.92403,
       0.94162, 0.94229, 0.9413 , 0.93455, 0.92228, 0.93531, 0.91617,
       0.83273, 0.8015 , 0.81269, 0.78461, 0.76563, 0.76959, 0.769  ,
       0.76417, 0.76214, 0.79439, 0.82379, 0.81264, 0.8466 , 0.91294,
       0.91634, 0.90865, 0.94742, 0.9754 , 0.97102, 0.97045, 0.97501,
       0.97519, 0.97558, 0.97525, 0.96872, 0.96264, 0.96926, 0.95972,
       0.91761, 0.90227, 0.91418, 0.88334, 0.8403 , 0.83562, 0.8435 ,
       0.85535, 0.8608 , 0.85737, 0.87404, 0.89244, 0.88682, 0.89365,
       0.924  , 0.93478, 0.92947, 0.93393, 0.93918, 0.93969, 0.93977,
       0.93479, 0.92921, 0.929  , 0.92966, 0.93317, 0.93658, 0.93377,
       0.93838, 0.95401, 0.95936, 0.95553, 0.96102, 0.97051, 0.97205,
       0.97124, 0.97024, 0.96748, 0.96714, 0.96767, 0.96648, 0.96534,
       0.96532, 0.96543, 0.96541, 0.96526, 0.96552, 0.96539, 0.96293,
       0.96097, 0.96157, 0.96129, 0.95844, 0.95669, 0.9584 , 0.95557,
       0.94731, 0.94461, 0.94529, 0.947  , 0.95106, 0.95179, 0.95091,
       0.95301, 0.95567, 0.95535, 0.95502, 0.95958, 0.96464, 0.96236,
       0.96361, 0.97827, 0.9863 , 0.98624, 0.98425, 0.9703 , 0.96148,
       0.96375, 0.96363, 0.96315, 0.96351, 0.96318, 0.96373, 0.96106,
       0.9602 , 0.9664 , 0.94354, 0.905  , 0.8974 , 0.90278, 0.91798,
       0.93367, 0.93081, 0.93193, 0.93942, 0.94115, 0.94415, 0.93313,
       0.9094 , 0.90283, 0.90547, 0.91552, 0.92935, 0.92612, 0.92824,
       0.94898, 0.95793, 0.96091, 0.95   , 0.91477, 0.89927, 0.90149,
       0.9207 , 0.94848, 0.95157, 0.94872, 0.94132, 0.92849, 0.93423,
       0.92892, 0.89123, 0.8712 , 0.8751 , 0.88167, 0.89349, 0.89318,
       0.89326, 0.91338, 0.9257 , 0.92326, 0.92244, 0.92238, 0.92126,
       0.92006, 0.92856, 0.94216, 0.94148, 0.93997, 0.95541, 0.96547,
       0.96716, 0.96459, 0.9386 , 0.91962, 0.92484, 0.92193, 0.91091,
       0.90844, 0.91031, 0.90737, 0.90193, 0.90534, 0.90196, 0.87785,
       0.86289, 0.86304, 0.87851, 0.90309, 0.90417, 0.90262, 0.91669,
       0.92249, 0.9288 , 0.91234, 0.86137, 0.84085, 0.84906, 0.86083,
       0.87231, 0.87172, 0.87173, 0.87255, 0.87447, 0.87403, 0.85423,
       0.83732, 0.8385 , 0.84405, 0.84958, 0.85395, 0.84912, 0.83258,
       0.81765])
    p=psd(s,0.25)