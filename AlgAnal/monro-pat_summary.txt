סיכום MunroPat

הקלט הוא מערך בגודל N. ברשותנו באפרים בגודל s. בשלבים מסויימים באלגוריתם יש יותר מבאפר אחד מלא אבל יש חסם על כמות הבאפרים.  S גדול מייצג את  כמות הזכרון הכוללת, כלומר כמות הבאפרים שיעשה בה שימוש חסומה.
האלגוריתם דומה לאלגוריתם עם הרמות שלמדנו בכיתה, כך שבעצם למדנו שכלול של MunroPat שמצליח להמנע מP מעברים, ויכול בכל רגע לשלוף את החציון עד אותו רגע.

MunroPat מניחים שהזכרון הוא נתון (אילוץ שלא ניתן לשנות) ולכן מספר המעברים נקבע בהתאם לזכרון שהקצו לנו. כשהזכרון קטן מדי, מספר המעברים יוצא גדול מדי ואז הם מודים שאין טעם לאלגוריתם שלהם, ומציעים אלגוריתם פשוט בהרבה. נתחיל מלתאר את הפשוט ונעבור לתיאור האלג' המלא.

האלגוריתם הפשוט מתבסס על באפר בגודל s, ו P מעברים, כך ש s*P>=N/2:  במעבר הראשון, תשמור את s הערכים הגדולים ביותר (הם לא מסבירים איך עושים את זה, כביכול זה טריוויאלי, אבל אני לא הצלחתי להראות שאפשר לעשות את זה ב (1)O לנתון מהסטרים. אני חושב שצריך O(log s) לכל נתון וזה הופך את האלג' למשמעותית פחות יעיל.)
בסוף המעבר, תבדוק מה הערך הכי *קטן* במערך שלך, זה הנתון ה-s בסטרים המלא. במעבר הבא, תתעלם מכל הנתונים הגדולים ממנו, בסוף המעבר יהיה בידך הנתון ה 2s בגודלו במערך. ככה ממשיכים עד שמגיעים לחציון.

האלגוריתם המלא:
התאור של האלגוריתם המלא כולל נוסחאות שלא פירטתי, המאמר מפרט איך לעדכן את החסמים ומוכיח למה זה מתכנס.
בכל מעבר ברצוננו לעדכן שני "פילטרים" (חסמים). החסמים מאותחלים לפלוס ומינוס אינסוף כלומר מעבירים הכל. את כל הערכים שבין שני הפילטרים אנחנו מנסים לשמור, אך מכיוון שאין לנו מקום לכך אנחנו מייצרים דגימה של הערכים שנמצאים ביניהם. הדגימה מבוססת על כך שבהתחלה דוגמים כל נתון (דגימה של 100%). אחרי שמילאנו שני באפרים בגודל s. אנחנו עושים צמצום לגודל s הצמצום נקרא merge.
בסוף המעבר החסמים מתעדכנים. כשהחסמים מתעדכנים אנחנו עדיין לא יודעים בדיוק את ה rank של הערך החדש שלהם במערך, כי העדכון מבוסס על הדגימה ולא על כל הערכים שהיו, אבל תוך כדי המעבר הבא אנחנו מגלים איזה rank מייצג כל חסם, ויש לנו שוב דגימה של הערכים שבין החסמים. בהתאם לrank אנחנו בוחרים את ערך החסמים החדשים מהאברים ששמרנו מהדגימה, וכך בכל מעבר הטווח ביניהם יצטמצם. במעבר האחרון יהיו ביניהם s אלמנטים ואז מובטח שאחד מתוך s האלמנטים הוא בדיוק החציון. 

ביצוע הדגימה על ה stream:
- s אברים ראשונים הכנס לבאפר הראשון (רמה 0)
- s אברים הבאים הכנס לבאפר השני (רמה 0)
- בצע איחוד של שני הבאפרים ע"י לקיחת האברים ה2i מכל אחד (מיקומים זוגיים)
- המשך לדגום 2 באפרים ברמה 0, אחד אותם ואז אחד אותם עם הבאפר הקודם שקודם לרמה 1, לייצירת באפר ברמה 2.
- המשך כך עד לרמה r כאשר r נקבע ע"י 
pow(2,r)*s >= n

- כדי לוודא שהתהליך מתבצע עד תומו משלימים את גודל הסטרים לחזקה שלמה של 2 ע"י הוספת אברים בגודל המקסימום של הסטרים
 